<?php
/* datos a formatear*/
$data = is_array($data)? $data:array($data);
/* delimitador entre campos */
$delimiter = empty($delimiter)? ',': $delimiter;

/*mime type para el contenido*/
header("Content-type: text/csv");
/*apertura del buffer de salida*/
$buffer = fopen('php://output', 'w');
foreach ($data as $key) {
    fputcsv($buffer, get_object_vars($key), $delimiter);
}
fclose($buffer);
